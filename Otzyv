
Функция OtzivOtziv(Запрос)
	Ответ = Новый HTTPСервисОтвет(200);
	
	ПараметрыЗапроса = Новый Соответствие;	
	ДанныеОтвета = Запрос.ПолучитьТелоКакСтроку();
	ЗаписьЖурналаРегистрации("Otziv",,,ДанныеОтвета);
	
	Если ТипЗнч(Запрос.ПараметрыЗапроса) = Тип("ФиксированноеСоответствие") И Запрос.ПараметрыЗапроса.Количество() > 0 Тогда
        // !!!!! Здесь возникают ошибки при передаче в параметрах значений с запрешенными знаками (например, кавычкой)

        // Это GET-запрос, параметры хранятся в Запрос.ПараметрыЗапроса

		
        Для Каждого КлючИЗначение Из Запрос.ПараметрыЗапроса Цикл
            ПараметрыЗапроса.Вставить(КлючИЗначение.Ключ, КлючИЗначение.Значение);
			ЗаписьЖурналаРегистрации(КлючИЗначение.Ключ,,,КлючИЗначение.Значение);

        КонецЦикла;
    Иначе
        // Это POST-запрос, параметры содержатся в теле запроса в виде строк

		
        ПараметрыЗапроса = Новый Соответствие;
        ПараметрыСтрокой = СтрЗаменить(РаскодироватьСтроку(Запрос.ПолучитьТелоКакСтроку(), СпособКодированияСтроки.КодировкаURL), "&", Символы.ПС);
        Для Счетчик = 1 По СтрЧислоСтрок(ПараметрыСтрокой) Цикл
            ТекущийПараметр = СтрЗаменить(СокрЛП(СтрПолучитьСтроку(ПараметрыСтрокой, Счетчик)), "=", Символы.ПС);
            Если ЗначениеЗаполнено(ТекущийПараметр) Тогда
                ПараметрыЗапроса.Вставить(СтрПолучитьСтроку(ТекущийПараметр, 1), СтрПолучитьСтроку(ТекущийПараметр, 2));
            КонецЕсли;
		КонецЦикла;
		
				
		ДокОценкаВрача = Документы.ОценкаВрача.СоздатьДокумент();
		ДокОценкаВрача.Врач =  Справочники.Doctor.ПолучитьСсылку(Новый УникальныйИдентификатор(ПараметрыЗапроса["Guid"]));
		ДокОценкаВрача.Дата = ТекущаяДата();
		ДокОценкаВрача.Комментарий = СокрЛП(СтрЗаменить(ПараметрыЗапроса["Comment"], "+", " "));
		ДокОценкаВрача.Оценка = Число(ПараметрыЗапроса["Mark"]);
		
		Попытка 
			 ДокОценкаВрача.Записать(РежимЗаписиДокумента.Проведение);
			 ЗаписьЖурналаРегистрации("ссылка",,,ДокОценкаВрача.Ссылка);
		 Исключение
			 ЗаписьЖурналаРегистрации("НеЗаписался",,,ОписаниеОшибки());
		КонецПопытки;
		
		
    КонецЕсли;
	
	
	Ответ.УстановитьТелоИзСтроки("test");
	
	Возврат Ответ;
КонецФункции
